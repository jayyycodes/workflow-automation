# Automation JSON Schema Reference

This document defines the **language-agnostic** JSON schema for automations in the Smart Workflow Automation Tool.

This schema will be:
- **Generated by AI** (Step 2) from natural language input
- **Stored in PostgreSQL** in the `automations` table
- **Executed by the workflow engine** (future steps)

---

## Core Schema

```json
{
  "name": "string (required)",
  "description": "string (optional)",
  "trigger": {
    "type": "string (required)",
    "...": "trigger-specific config"
  },
  "steps": [
    {
      "type": "string (required)",
      "...": "step-specific config"
    }
  ],
  "status": "draft | active | paused"
}
```

---

## Trigger Types

| Type | Description | Config Fields |
|------|-------------|---------------|
| `manual` | User-initiated only | *none* |
| `interval` | Repeating schedule | `every`: duration string |
| `webhook` | External HTTP call | `path`: webhook endpoint |
| `event` | System event trigger | `event`: event name |

### Interval Duration Format

| Value | Meaning |
|-------|---------|
| `1m` | Every 1 minute |
| `5m` | Every 5 minutes |
| `1h` | Every 1 hour |
| `1d` | Every 1 day |
| `1w` | Every 1 week |

### Trigger Examples

```json
// Manual trigger
{ "type": "manual" }

// Every 5 minutes
{ "type": "interval", "every": "5m" }

// Webhook trigger
{ "type": "webhook", "path": "/hooks/stock-update" }
```

---

## Step Types

| Type | Description | Required Fields |
|------|-------------|-----------------|
| `fetch_stock_price` | Get stock price | `symbol` |
| `fetch_crypto_price` | Get crypto price | `symbol` |
| `fetch_url` | HTTP GET request | `url` |
| `send_whatsapp` | Send WhatsApp message | `to`, `message` |
| `send_email` | Send email | `to`, `subject`, `body` |
| `send_sms` | Send SMS | `to`, `message` |
| `condition` | Conditional branch | `if`, `then`, `else` |
| `transform` | Transform data | `expression` |
| `delay` | Wait before next step | `duration` |

### Step Examples

```json
// Fetch stock price
{
  "type": "fetch_stock_price",
  "symbol": "AAPL",
  "outputAs": "stockData"
}

// Send WhatsApp
{
  "type": "send_whatsapp",
  "to": "+1234567890",
  "message": "AAPL is now at {{stockData.price}}"
}

// Conditional
{
  "type": "condition",
  "if": "{{stockData.price}} > 150",
  "then": [{ "type": "send_whatsapp", "message": "Price alert!" }],
  "else": []
}
```

---

## Variable Interpolation

Use `{{variableName}}` syntax to reference:
- Previous step outputs
- Trigger input data
- Built-in variables (`{{now}}`, `{{date}}`)

```json
{
  "type": "send_email",
  "to": "user@example.com",
  "subject": "Stock Update - {{date}}",
  "body": "Current price: {{stockData.price}}"
}
```

---

## Complete Example

```json
{
  "name": "Stock Price Monitor",
  "description": "Send stock prices every 5 minutes on WhatsApp",
  "trigger": {
    "type": "interval",
    "every": "5m"
  },
  "steps": [
    {
      "type": "fetch_stock_price",
      "symbol": "AAPL",
      "outputAs": "priceData"
    },
    {
      "type": "condition",
      "if": "{{priceData.change}} > 2",
      "then": [
        {
          "type": "send_whatsapp",
          "to": "+1234567890",
          "message": "ðŸš¨ AAPL moved {{priceData.change}}%! Now: ${{priceData.price}}"
        }
      ],
      "else": []
    }
  ],
  "status": "active"
}
```

---

## Status Values

| Status | Meaning |
|--------|---------|
| `draft` | Created but not running |
| `active` | Scheduled/listening for triggers |
| `paused` | Temporarily disabled |

---

## Future Extensions

These will be added in later steps:
- `voice_trigger` - Voice command activation
- `ai_decision` - LLM-powered step logic
- `parallel` - Run steps in parallel
- `loop` - Iterate over data
